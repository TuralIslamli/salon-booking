(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{33:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>C});var s=t(5155),n=t(2398),i=t(6798),r=t(7068),l=t.n(r),o=t(2115),d=t(5695),c=t(6766),u=t(2960),m=t(8363),h=t(4775),p=t(5657),v=t(2177),_=t(6277),g=t(6274),x=t(3844),y=t(7692),j=t(1556),b=t.n(j),N=t(5041),f=t(3319),q=t(7129),k=t(2461);let I=(e,a)=>{if(!e||!a)return!1;try{let[t,s]=a.split(":").map(e=>parseInt(e,10)),n=new Date(e);return n.setHours(t||0,s||0,0,0),n.getTime()>=Date.now()}catch(e){return!1}},w=q.Ik({client_name:q.Yj().transform(e=>"string"==typeof e?e.trim():e).required("M\xfcştəri adı m\xfctləqdir").min(2,"Minimum 2 simvol").max(80,"Maksimum 80 simvol").matches(RegExp("^[\\p{L}][\\p{L}\\p{M}\\s.'-]{1,79}$","u"),"Yalnız hərflər, boşluq, n\xf6qtə, tire və apostrof"),services:q.YO(q.Ik({id:q.ai().required(),name:q.Yj().required()})).min(1,"Ən azı bir xidmət se\xe7in").required("Ən azı bir xidmət se\xe7in"),date:q.gl().required("Tarix se\xe7in").test("is-date","D\xfczg\xfcn tarix se\xe7in",e=>e instanceof Date&&!isNaN(e.getTime())),hour:q.Ik({time:q.Yj().required()}).nullable().required("Saat se\xe7in").test("has-time","Saat se\xe7in",e=>!!e&&"string"==typeof e.time&&e.time.length>0),doctor:q.Ik({id:q.ai().required(),full_name:q.Yj().required()}).nullable().required("Həkim se\xe7in")}).test("future-datetime","Ke\xe7miş zaman se\xe7ilə bilməz",e=>{var a,t,s;let n=null!=(t=e.date)?t:null,i=null!=(s=null==(a=e.hour)?void 0:a.time)?s:null;return!n||!i||I(n,i)}),S=e=>{let{visible:a,onHide:t,refetch:i}=e,{control:r,handleSubmit:l,reset:o,watch:d,setValue:c,getValues:h,formState:{errors:j,isValid:q,isSubmitting:I}}=(0,v.mN)({mode:"onChange",reValidateMode:"onChange",resolver:(0,k.t)(w),shouldUnregister:!1,defaultValues:{client_name:"",services:[],doctor:null,date:void 0,hour:null}}),S=d("date"),C=d("hour"),{data:M=[],isLoading:T}=(0,u.I)({queryKey:["services"],queryFn:m.ju}),{data:L=[],isLoading:P}=(0,u.I)({queryKey:["hours",S],queryFn:()=>(0,m.Tl)((0,f.GP)(S,"yyyy-MM-dd")),enabled:!!S}),{data:Y=[],isLoading:z}=(0,u.I)({queryKey:["doctors",S,C],queryFn:()=>(0,m.ps)("".concat((0,f.GP)(S,"yyyy-MM-dd")," ").concat(null==C?void 0:C.time)),enabled:!!S&&!!(null==C?void 0:C.time)}),{mutate:H}=(0,N.n)({mutationFn:e=>(0,m.sH)(e)});return(0,s.jsx)(p.l,{header:"Yeni rezervasiya",visible:a,style:{width:"100%",maxWidth:"500px"},modal:!0,onHide:()=>{o(),t()},children:(0,s.jsxs)("form",{onSubmit:l(e=>{var a;H({client_name:e.client_name.trim(),doctor_id:null==(a=e.doctor)?void 0:a.id,reservation_date:"".concat((0,f.GP)(e.date,"dd-MM-yyyy")," ").concat(e.hour.time),service_types:e.services.map(e=>({id:e.id}))},{onSuccess:()=>{o(),t(),i()}})}),className:b().form,children:[(0,s.jsx)("label",{children:"M\xfcştəri adı"}),(0,s.jsx)(v.xI,{name:"client_name",control:r,render:e=>{let{field:a}=e;return(0,s.jsx)(_.S,{...a,className:"".concat(b().input," ").concat(j.client_name?"p-invalid":"")})}}),(0,s.jsx)("label",{children:"Xidmətlər"}),(0,s.jsx)(v.xI,{name:"services",control:r,render:e=>{let{field:a}=e;return(0,s.jsx)(y.K,{...a,filter:!0,options:M,optionLabel:"name",placeholder:T?"Y\xfcklənir...":"Xidmət se\xe7in",className:"".concat(b().input," ").concat(j.services?"p-invalid":""),disabled:T,onChange:e=>a.onChange(e.value)})}}),(0,s.jsx)("label",{children:"Tarix"}),(0,s.jsx)(v.xI,{name:"date",control:r,render:e=>{let{field:a}=e;return(0,s.jsx)(g.V,{...a,dateFormat:"dd.mm.yy",minDate:new Date,showIcon:!0,className:"".concat(b().input," ").concat(j.date?"p-invalid":""),onChange:e=>{a.onChange(e.value),c("hour",null,{shouldValidate:!0}),c("doctor",null,{shouldValidate:!0})}})}}),(0,s.jsx)("label",{children:"Saat"}),(0,s.jsx)(v.xI,{name:"hour",control:r,render:e=>{let{field:a}=e;return(0,s.jsx)(x.m,{...a,options:L,optionLabel:"time",placeholder:P?"Y\xfcklənir...":"Saat se\xe7in",className:"".concat(b().input," ").concat(j.hour?"p-invalid":""),disabled:!S||P,onChange:e=>a.onChange(e.value)})}}),(0,s.jsx)("label",{children:"Həkim"}),(0,s.jsx)(v.xI,{name:"doctor",control:r,render:e=>{let{field:a}=e;return(0,s.jsx)(x.m,{...a,options:Y,optionLabel:"full_name",placeholder:z?"Y\xfcklənir...":"Həkim se\xe7in",className:"".concat(b().input," ").concat(j.doctor?"p-invalid":""),disabled:!S||!(null==C?void 0:C.time)||z,onChange:e=>a.onChange(e.value)})}}),(0,s.jsx)(n.$,{type:"submit",label:I?"G\xf6ndərilir...":"Təsdiqlə",className:b().submit,disabled:!q||I})]})})};function C(){let e=(0,d.useRouter)(),[a,t]=(0,o.useState)(!1);(0,o.useEffect)(()=>{localStorage.getItem("customerToken")||e.push("/login")},[e]);let{data:r,isLoading:p,refetch:v}=(0,u.I)({queryKey:["bookings"],queryFn:async()=>(0,m.dJ)()}),_=(null==r?void 0:r.data)||[];return(0,s.jsxs)("div",{className:l().page,children:[(0,s.jsxs)("header",{className:l().header,children:[(0,s.jsx)(c.default,{src:"/logo15.svg",alt:"googlePlay",width:150,height:100,className:l().googlePlay}),(0,s.jsxs)("div",{className:l().header__actions,children:[(0,s.jsx)(n.$,{label:"+",severity:"warning",rounded:!0,"aria-label":"Yeni sifariş",onClick:()=>t(!0),className:l().addButton}),(0,s.jsx)(n.$,{icon:"pi pi-sign-out",severity:"warning",rounded:!0,className:l().addButton,onClick:()=>{localStorage.clear(),e.push("/login")}})]})]}),(0,s.jsxs)("main",{className:l().cardList,children:[p&&(0,s.jsx)("div",{children:"Y\xfcklənir..."}),null==_?void 0:_.map(e=>(0,s.jsxs)(i.Z,{className:l().card,children:[(0,s.jsxs)("div",{className:l().item,children:[(0,s.jsx)("span",{className:l().label,children:"Tarix:"})," ",e.reservation_date]}),(0,s.jsxs)("div",{className:l().item,children:[(0,s.jsx)("span",{className:l().label,children:"Məbləğ:"})," ",e.total_amount," ₼"]}),(0,s.jsxs)("div",{className:l().item,children:[(0,s.jsx)("span",{className:l().label,children:"M\xfcştəri:"})," ",e.client_name]}),(0,s.jsxs)("div",{className:l().item,children:[(0,s.jsx)("span",{className:l().label,children:"Telefon:"})," ",e.client_phone]})]},e.id)),!(null==_?void 0:_.length)&&!p&&(0,s.jsx)(h.Q,{severity:"secondary",text:"Rezervasiya m\xf6vc\xfcd deyil"})]}),(0,s.jsx)(S,{visible:a,onHide:()=>t(!1),refetch:v})]})}},1556:e=>{e.exports={form:"styles_form__PXcis",input:"styles_input__wAtPS",submit:"styles_submit__fP6Vi"}},7068:e=>{e.exports={page:"page_page__KdIv3",header:"page_header__Tcoou",header__actions:"page_header__actions__PnFn9",addButton:"page_addButton__PHKv8",cardList:"page_cardList__wh_31",card:"page_card___3JVW",item:"page_item__E_GBt",label:"page_label__mJHLU"}},8363:(e,a,t)=>{"use strict";t.d(a,{sH:()=>m,Tl:()=>c,dJ:()=>o,ps:()=>u,ju:()=>d,U5:()=>r,i6:()=>l});var s=t(3464),n=t(5695);let i=s.A.create({baseURL:"https://dev-api.nargizestetik.az/customer-api"});i.interceptors.request.use(e=>{let a=localStorage.getItem("customerToken");return a&&(e.headers=e.headers||{},e.headers.Authorization="Bearer ".concat(a)),e}),i.interceptors.response.use(e=>null==e?void 0:e.data,async e=>{var a,t;return(e.response&&(null==(a=e.response)?void 0:a.data.message)==="USER_NOT_AUTHORIZED"?(localStorage.clear(),(0,n.redirect)("/login")):e.response&&(null==(t=e.response)?void 0:t.data.message)||e.message,e&&e.response)?Promise.reject(e):Promise.reject()});let r=e=>i.post("auth/otp/request",e),l=e=>i.post("auth/otp/verify",e),o=()=>i.get("/reservations"),d=async()=>{let{data:e}=await i.get("/service-types/input-search");return e},c=async e=>{let{data:a}=await i.get("/reservation-times/input-search?date=".concat(e));return a},u=async e=>{let{data:a}=await i.get("/reservations/users/input-search?date_time=".concat(e));return a},m=async e=>i.post("/reservations",e)},8460:(e,a,t)=>{Promise.resolve().then(t.bind(t,33))}},e=>{var a=a=>e(e.s=a);e.O(0,[465,808,144,605,229,441,684,358],()=>a(8460)),_N_E=e.O()}]);